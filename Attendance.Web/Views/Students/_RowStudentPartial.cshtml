@using Attendance.Data.Entities
@model Attendance.Data.VModels.StudentListItemViewModel

<tr id="row-@Model.Id"
    data-student-id="@Model.Id"
    data-firstname="@Model.FirstName"
    data-lastname="@Model.LastName"
    data-birthdate="@Model.BirthDateShamsi"
    data-fathername="@Model.FatherName"
    data-nationalcode="@Model.NationalCode"
    data-grade="@Model.Grade"
    data-school="@Model.SchoolName"
    data-coach="@Model.CoachName"
    data-photo="@Model.Photo"
    data-isactive="@Model.IsActive.ToString().ToLower()"
    data-inactivereason="@Model.InactiveReason"
    data-entrydate="@Model.EntryDateShamsi"
    data-paymentstatus="@Model.PaymentStatus"
    class="px-2 py-1 border-b hover:bg-blue-100/20 transition @(Model.IsActive ? "" : "bg-rose-100/50 text-rose-700")">

    <!-- تصویر -->
    <td class="px-2 py-1 align-middle text-center">
        <img src="@(Model.Photo ?? "/uploads/students/default.png")"
             alt="عکس @Model.FirstName @Model.LastName"
             class="w-10 h-10 object-cover rounded-lg border mx-auto" />
    </td>

    <!-- نام‌ها -->
    <td class="px-2 py-1 text-sm font-semibold text-center">@Model.FirstName</td>
    <td class="px-2 py-1 text-sm font-semibold text-center">@Model.LastName</td>
    <!-- تاریخ تولد -->
    <td class="px-2 py-1 text-sm font-semibold text-center">
        @(string.IsNullOrWhiteSpace(Model.BirthDateShamsi) ? "-" : Model.BirthDateShamsi)
    </td>
    <td class="px-2 py-1 text-sm font-semibold text-center">@Model.NationalCode</td>
    <td class="px-2 py-1 text-sm font-semibold text-center">@Model.Grade</td>
    <td class="px-2 py-1 text-sm font-semibold text-center">@Model.SchoolName</td>
    @* <td class="px-2 py-1 text-sm text-center">@Model.CoachName</td> *@

    <!-- وضعیت پرداخت -->
    <td class="px-2 py-1 text-sm text-center">
        @switch (Model.PaymentStatus)
        {
            case PaymentStatus.Paid:
                <span class="inline-block px-3 py-1 font-bold text-emerald-700 text-teal-800 bg-teal-100/50 rounded">پرداخت شده</span>
                break;
            case PaymentStatus.Unpaid:
                <span class="inline-block px-2 py-1 font-semibold text-sm text-rose-800 bg-rose-100/50 rounded">پرداخت نشده</span>
                break;
            case PaymentStatus.InProgress:
                <span class="inline-block px-3 py-1 font-bold text-amber-500 bg-amber-100/50 rounded">در حال پرداخت</span>
                break;
            default:
                <span class="inline-block px-3 py-1 font-bold text-slate-700 bg-slate-100/50 rounded">ثبت نشده</span>
                break;
        }
    </td>

    <!-- وضعیت فعال -->
    <td class="px-2 py-1 text-sm text-center">
        @if (Model.IsActive)
        {
            <span class="inline-block px-3 py-1 font-bold text-green-600 bg-green-100/50 rounded">فعال</span>
        }
        else
        {
            <span class="inline-block px-2 py-1 font-semibold text-sm text-rose-800 bg-rose-100/50 rounded">غیرفعال</span>
        }
    </td>

    <!-- عملیات -->
    <td class="px-2 py-1 text-sm text-center">
        <div class="flex items-center justify-center gap-2">

            <!-- جزئیات -->
            <a asp-action="Details" asp-route-id="@Model.Id"
               class="bg-blue-100/50 text-slate-800 px-2 py-1 text-sm rounded hover:bg-blue-200/50 font-bold transition">
                جزئیات
            </a>

            <!-- ویرایش -->
            <a asp-action="Edit" asp-route-id="@Model.Id"
               class="bg-amber-100/50 text-amber-500 px-2 py-1 rounded text-sm hover:bg-amber-200/50 font-bold transition">
                ویرایش
            </a>

            <!-- غیرفعال‌سازی -->
            @if (Model.IsActive)
            {
                <form asp-controller="Students" asp-action="DeleteConfirmed" method="post" class="delete-form inline">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="Id" value="@Model.Id" />
                    <input type="hidden" name="InactiveReason" class="inactive-reason-input" value="" />
                    <button type="submit"
                            class="student-delete-btn bg-rose-100/50 text-rose-700 px-2 py-1 rounded text-sm hover:bg-rose-100 font-bold transition"
                            data-id="@Model.Id"
                            data-name="@(Model.FirstName + " " + Model.LastName)">
                        غیرفعال
                    </button>
                </form>
            }

            <!-- حذف دائم -->
            <a asp-action="Archive" asp-route-id="@Model.Id"
               class="bg-pink-600 text-white px-2 py-1 rounded text-sm hover:bg-pink-700 transition hidden"
               title="حذف دائمی اطلاعات دانش‌آموز">
                حذف دائم
            </a>
        </div>
    </td>

    <!-- علت غیرفعال‌سازی -->
@*     <td class="px-2 py-1 text-sm text-center">
        @if (!Model.IsActive && !string.IsNullOrWhiteSpace(Model.InactiveReason))
        {
            <div class="max-w-xs mx-auto break-words text-sm text-pink-800 bg-pink-100 px-2 py-1 rounded">
                @Model.InactiveReason
            </div>
        }
        else
        {
            <span class="text-slate-400">—</span>
        }
    </td> *@
</tr>
